# לוח שנה עברי
## מה הפרויקט הזה?
זהו אתר המחשב תאריך עברי ואת מועדי ישראל על בסיס התאריך הלועזי. בנוסף, האתר מציג את זמני הזריחה והשקיעה על בסיס קווי אורך ורוחב של כל עיר. בכך, האתר מאפשר שימוש גם במצב לא מקוון וללא חיבור לאינטרנט.

מסמך זה מפרט את צורת החישוב של התאריך העברי על כלל כלליו ומציג דוגמאות להמחשת התהליך.

## איך זה עובד?
לצורך ההסבר נעבוד בצמוד לקוד באמצעות הטמעה של חלקים חשובים ממנו.
הקוד עצמו מתחיל בפונקציית `()runAll` אשר קוראת לכלל הפונקציות בקוד ולבסוף משימה את התוצאות במקומות המתאימים באתר.
בשביל שיהיה קל יותר לעקוב, כל פונקציה פנימית בפונקציה הראשית תסומן במספור משלה, כלומר כאשר נדבר על הפונקציה `()getYear` נמספר אותה ב-1, את `calcRiseSet(isRise, id)` ב-2 וכך הלאה...
### חישוב תאריך עברי
ראשית, אנו מגדירים את התאריך והחודש העבריים להיות בעלי ערך ברירת מחדל של 1.

#### 1. פונקציית `()getYear`
פונקציה זו תפקידה להשיג את התאריך הלועזי ואת הזמן (שעות ודקות) כרגע. הנתונים האלו נשמרים בזיכרון הלוקלי של האתר.

#### 2. פונקציית `calcRiseSet(isRise, id)`
פונקציה זו מקבלת משתנה בוליאני האם מחשבים זמן זריחה ואת שם המשתנה בזיכרון הלוקלי אליו נשמור את הזמן. היא מחשבת את זמן הזריחה או השקיעה בהתאם לפרמטר שהועבר לה, והיא שומרת אותו במשתנה מתאים בזיכרון הלוקלי.

החישוב נפתח בהשגת קווי האורך והרוחב של העיר שנבחרה בהגדרות. לאחר מכן מוגדרים הקבועים:
```js
const toRad = Math.PI / 180;
const toDeg = 180 / Math.PI;
const zenith = 90.8;
```
כאשר השניים הראשונים הם מעבר בין מעלות לרדיאנים ובין רדיאנים למעלות בהתאמה. המשתנה השלישי הינו הזווית של השמש ביחס לכדור הארץ. מאחר שבשקיעה ובזריחה השמש אופקית, אזי הזווית היא $90\degree$. עם זאת, כיוון שבמעבר קרני השמש באטמוספירה קורית שבירה, אזי הזווית האמיתית לזריחה ושקיעה היא $90\degree 50\prime$[^1], כאשר בהמרה לזווית במעלות:

$50/60\approx0.8333 \rightarrow 90\degree 50\prime\approx90.8\degree$

לאחר מכן מוחזרים היום, החודש והשנה של היום הנבחר.

כעת נתעסק בחישוב הזמנים:

א. ראשית יש לקבוע האם אנו בשעון חורף או קיץ. לשם כך נבדוק אם אנו בין מרץ לאוקטובר (לא כולל) - אם כן אזי אנו בשעון קיץ. אם לא אז נבדוק אם אנו בחודש מרץ - אם כן נמצא את יום שישי לפני יום ראשון האחרון בחודש מרץ ואם היום הוא אחריו אזי אנו כבר בשעון קיץ. באופן דומה, נבדוק אם אנו בחודש אוקטובר - אם כן אז נמצא את יום ראשון האחרון של אותו חודש ואם אנו לפניו אזי אנו עדיין בשעון קיץ. [^3]

> **דוגמה**
> 
> החישוב למשל של יום שישי לפני יום ראשון האחרון של חודש מרץ:
> ```js
> var d = new Date();
> d.setFullYear(year, 2, 31);
> var fridayBeforeSunday = d.getDate() - d.getDay() - 2;
> ```
> כאשר אנו מגדירים תאריך חדש בתור ה-31 במרץ (הקוד כתוב ב-JS ובו חודשים מסומנים בין 0 ל-11). יום שישי הרלוונטי מתקבל באמצעות חיסור של היום בשבוע (ראשון - 0, שני - 1...) מ-31 ועוד חיסור של 2 בשביל להגיע מראשון האחרון ליום שישי. כך מתקבל התאריך הלועזי של יום שישי לפני יום ראשון האחרון של חודש מרץ.

 ב. לאחר מכן מבוצע חישוב של היום בשנה (1 זה ה-1/1, 2 זה ה-2/1... המספר של היום הוא שלם בין 1 ל-365 (או 366 בשנה מעוברת)), חישובי שעות, תיקונים שלהם ועוד.[^2]

 ג. השעה של הזריחה/השקיעה נשמר במשתנה `id` בזיכרון הלוקלי.

 > [!NOTE]
> ההסברים שיובאו להלן מבוססים על אתר [ויקישיבה](https://www.yeshiva.org.il/wiki/index.php/%D7%9E%D7%93%D7%A8%D7%99%D7%9A_%D7%9C%D7%94%D7%9B%D7%A0%D7%AA_%D7%9C%D7%95%D7%97_%D7%A9%D7%A0%D7%94_%D7%A2%D7%91%D7%A8%D7%99)

 #### 3. פונקציית `()getPassover`

פונקציה זו מחשבת את היום בחודש מרץ בו יחול פסח השנה. הפונקציה מבוססת על נוסחת גאוס לחישוב התאריך של פסח.[^4]

הקוד של הפונקציה הינו:
```js
function getPassover(){
	var A = parseInt(year) + 3760;
	var a = (12 * A + 17) % 19;
	var b = A % 4;
	var x = 32 + (4343/98496) + (1 + 272953/492480) * a + b / 4 - (313 / 98496) * A;
	var c = (3 * A + 5 * b + parseInt(x / 1) + 5) % 7;
	
	if(c == 2 || c == 4 || c == 6){
		passover = 1 + parseInt(x / 1);
	} else if (c == 1 && a > 6 && x % 1 >= (1367/2160)){
		passover = 2 + parseInt(x / 1);
	} else if(c == 0 && a > 11 && x % 1 >= (23269 / 25920)){
		passover = 1 + parseInt(x / 1);
	} else 
		passover = parseInt(x / 1);
	
	passover += 13 - 31;
}
```
כעת נעבור על הקוד בצמוד לנוסחה:

	א. תחילה, יש לחשב את השנה העברית. אנו יודעים כי קיים הפרש של 3760 שנים בין השנה הלועזית לעברית ולכן נוסיף הפרש זה.

	ב. לאחר מכן עלינו לחשב את השאריות של הביטויים הבאים:

$$a=\left[\frac{12A+17}{19}\right]_r \enspace;\enspace b = \left[\frac{A}{4}\right]_r$$

	כאשר $[]_r$ מסמן לקיחת השארית של הביטוי.

	ג. כעת מתקיים השיוויון הבא:

$$M+m = 32 + \frac{4343}{98496} + \left(1+\frac{272953}{492480}\right)a+\frac{b}{4}-\left(\frac{313}{98496}\right)A$$

	כאשר $M$ הוא החלק השלם של הביטוי באגף ימין, ו-$m$ הוא השארית של הביטוי באגף ימין.

	ד. אם כן, פסח, אשר חל בט"ו ניסן, יחול ב-$M$ במרץ, אלא אם מתקיים אחד משלושת המקרים היחודיים הבאים:
		נגדיר את:

		$$c=\left[\frac{3A+5b+M+5}{7}\right]_r$$

		1. אם $c=2,4,6$ אזי פסח יחול ב-$M+1$ במרץ.

		2. אם $c=1, a>6, m>=\frac{1367}{2160}$, אזי פסח יחול ב-$M+2$ במרץ.

		3. אם $c=0,a>11,m>=\frac{23269}{25920}$, אזי פסח יחול ב-$M+1$ במרץ.
 

[^1]: 90 מעלות ו-50 דקות קשת. דקת קשת היא יחידת מידה זוויתית ששווה ל-1⁄60 מעלה ומסומנת ב-`'`.
[^2]: מבוסס על [האתר](https://edwilliams.org/sunrise_sunset_algorithm.htm) שמבוסס על Almanac for Computers מאת Nautical Almanac Office, United States Naval Observatory.
[^3]: בישראל שעון קיץ מתחיל ביום שישי לפני יום ראשון האחרון של חודש מרץ ועד ליום ראשון האחרון של חודש אוקטובר.
[^4]: מבוסס על [WikiBooks](https://en.wikibooks.org/wiki/Mathematics_of_the_Jewish_Calendar/Printable_version#Gauss'_Formula_for_the_Date_of_Pesach)
